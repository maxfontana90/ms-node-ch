# README

[Nest](https://github.com/nestjs/nest) framework TypeScript starter repository.

## Requirements
* Node >=10
* Yarn >=1.6

## Installation
1. Clone the project
```bash
$ git clone git@github.com:maxfontana90/ms-node-ch.git 
$ cd ./ms-node-ch
```

2. Install dependencies
```bash
$ yarn install
```

3. Kick the app
```bash
# watch mode
$ yarn start:dev

# production mode
$ yarn start:prod
```

## Contribute

NOTE: Follow Microsoft's [Web API Design Guidelines](https://docs.microsoft.com/en-us/azure/architecture/best-practices/api-design)

### Committing changes

This repo uses [Commitizen](https://commitizen.github.io/cz-cli/). 
The package version and the CHANGELOG rely on [Conventional Commits](https://www.conventionalcommits.org/).
 
```bash
## Add all the target files to staging then run
$ yarn commit
```
 
### Release
```bash
## Switch to master branch, pull latest changes, bump the version & push new tags
$ git checkout master
$ git pull origin master
$ yarn bump
$ git push --follow-tags origin master
```

## Data Layer

For development purpose and simplicity, we are using sqlite3 as our main persistence mechanism. 
The file is located inside the distribution folder `./dist/blog.sqlite` (it's autogenerated)

For other storage mechanisms, create a new provider that handles connections to DB inside the following folder: 
`src/modules/data-access`

## API Documentation

We are using [@nestjs/swagger](https://github.com/nestjs/swagger) to document the API.

### Launching docs
1. Add swagger annotations to your controllers, schemas & DTOs.
2. Open http://localhost:3000/api-docs in your browser of preference and voilÃ . 

### Getting started
1. Create a user by posting to `/auth/sign-up`
    ```bash
    curl --location --request POST 'http://localhost:3000/auth/sign-up' \
    --header 'Content-Type: application/json' \
    --data-raw '{
        "username": "foobar",
        "email": "user@example.net",
        "password": "_passWORD123",
        "firstName": "Foo",
        "lastName": "Bar"
    }'
    ```
2. Get the access token by posting to `/auth/login`
    ```bash
    curl --location --request POST 'http://localhost:3000/auth/login' \
    --header 'Content-Type: application/json' \
    --data-raw '{
        "username": "foobar",
        "password": "_passWORD123"
    }'
    ```
3. Create a blog post by posting to `/posts`
    ```bash
   curl --location --request POST 'http://localhost:3000/posts' \
   --header 'Content-Type: application/json' \
   --header 'Authorization: Bearer XXXXXXX' \
   --data-raw '{
       "title": "Mi First Post!!! ðŸ˜‹",
       "published": true,
       "body": "TBD",
       "visibility": "public"
   }'
    ```
4. Fetch the list of published posts
    ```bash
    curl  --request GET 'http://localhost:3000/posts'
    ```
5. Fetch your post's details based on its `slugid`
    ```bash
    curl  --request GET 'http://localhost:3000/posts/:slugid'    
    ```
